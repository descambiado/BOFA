#!/usr/bin/env python3
"""
Payload Encoder - Codificación de payloads
=========================================

Codifica una cadena en base64, URL o hex. Útil para preparar payloads en pruebas de seguridad.
Uso: python3 payload_encoder.py --payload "texto" --encoding base64
"""

import argparse
import base64
import sys
import urllib.parse


def main():
    parser = argparse.ArgumentParser(description="Codificar payload para pruebas de seguridad")
    parser.add_argument("--payload", type=str, required=True, help="Cadena a codificar")
    parser.add_argument("--encoding", type=str, default="base64", choices=["base64", "url", "hex"], help="Tipo de codificación")
    parser.add_argument("--decode", action="store_true", help="Decodificar en lugar de codificar")
    args = parser.parse_args()

    try:
        data = args.payload
        if args.encoding == "base64":
            if args.decode:
                result = base64.b64decode(data).decode("utf-8", errors="replace")
            else:
                result = base64.b64encode(data.encode("utf-8")).decode("ascii")
        elif args.encoding == "url":
            if args.decode:
                result = urllib.parse.unquote(data)
            else:
                result = urllib.parse.quote(data, safe="")
        elif args.encoding == "hex":
            if args.decode:
                result = bytes.fromhex(data.replace(" ", "")).decode("utf-8", errors="replace")
            else:
                result = data.encode("utf-8").hex()
        else:
            print("Encoding no soportado", file=sys.stderr)
            return 1
        print(result)
        return 0
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        return 1


if __name__ == "__main__":
    sys.exit(main())
